version: 2.1
jobs:
  Nitdroid-Reborn:
   docker:
      - image: dopaemon/nitdroid:latest
   steps:
      - run:
          name: Disk Info
          no_output_timeout: 20m
          command: |
            lscpu
            df -h
      - run:
          name: Python 3.5
          no_output_timeout: 20m
          command: |
            sudo apt-get update
            sudo apt-get install software-properties-common -y
            sudo add-apt-repository --yes ppa:fkrull/deadsnakes
            sudo apt-get update
            sudo apt-get install python3.5 -y
            sudo ln -sf python3.5 /usr/bin/python
      - run:
          name: Repo Sync
          no_output_timeout: 20m
          command: |
            mkdir -p Nitdroid && cd Nitdroid
            repo init -u git://gitorious.org/android-n900/nitdroid_platform_manifest.git -b ics
            repo sync -j$(nproc --all)
      - run:
          name: Setup CCACHE
          no_output_timeout: 20m
          command: |
            echo "ccache -M 50G" > ~/.bashrc
            echo "ccache -o compression=true" > ~/.bashrc
            ccache -M 50G
            ccache -o compression=true
      - run:
          name: Disk Info
          no_output_timeout: 20m
          command: |
            lscpu
            df -h
            java -version
workflows:
  version: 2.1
  cooking:
    jobs:
      - Nitdroid-Reborn
